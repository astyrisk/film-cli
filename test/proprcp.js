const fs = require('fs');

// Read the JS content from the file
const jsContent = fs.readFileSync('scripts/prorcp.js', 'utf8');

const test_string_val = "d3a127656514c3f3b520f171c070a7f7b423a01374f1e70091918086775324a563f635d19520c156f53762a3e777d2c5f41510a5e155d133f5c2e673a2c6c582833492c6165654456583807390f18182f7d0d14085b28030d7f592039524d09224c0348231e527f7904141160264f0d4f194e0909277d1d36552e041b2c090a401d7e37067c58522c3025140f1203722f7e517e363d190468071b4d742b0d610d4c26256e16723a7504761a631b54366d1907243d0c787c341e4f6d360c501c6d18144e5c710c3f384d0d125e520c7d1870292938075717256b465175502c510e1d4566781502765827792b71044d135b372d16750877186767183d4e310e01357461706c21757c7f5028791d6b2e72370e27024a7c25177b12355c16506b230b59487f763b4e270e430b2c5e1b4b166d11211671190861433e5c064e2b38100f171c070e7e1b64347d2e635974191c067b5a28084f5e261d784c6f1716446a081023030d191650591a125776300a5d335125384d76103c60065c772748624c2e3c194a2e1d2962187a5803241b11107c721c594d2a2e0d0d01236879456b1a2f0b671c18504638420b4e33392a290a7822604754167d1d0302634a4451092f094f314c21667f4d2607073b312c5f3358796327125b2778162e516e5519347f7e274527171f723c04451514157f2259773b2329663d4c36214c410c3e342f482c542e0e23460f0c2239270809200f446b3519784e73010d6344662e0d0461611a2141665a11104807163566772a044e2918093c43213f726a420c067f680f4929610b452b0530295d7751175b5d7b502c5f00462c08551e593e32337a33483b0f1b6358621d26272e68045b744e280f7e470d79140a53771c070a7e096028711f5e577c5a2f116c4d72114b2e533f4b085b39781711462932335f6a5e09106959525d543a0a324f29051822400a79307e151260674414700c501b49535c3048156231192e786e152b4c475f065d3d0d1760044370657e0e790d121b573d78174a073836325d751a404f1b3842274a206b7d78720d717b6d1c5e387a6a5c03713d2a5b3900215571683c0c513567126e045c523522367a3e65010c60623a7b43122b2902005e4269061f51374f3f3a757c153a0f7f4e3c7e04592b18235f30160d137914135943020f4a417e2933730d7505157c0c125b3d793a192d07342d30094d341c446c5b284a114822227a14493126746b3e68200f384f1e57221d2e7a7203306b693138733a616f6c755b0c2d38680100591d606f6a5e723e1c5f084223027a47151a784168013f7d7b6132027d792e125f570f1b074747280934472e355d330e284c0d7a3d3e6f157114711a542168066e1c1b2e723f0b28730c7b29027e200a79347e07167c6b75297e0413285e444a6a511112443b1d3c5a3b451f3c113f4c0d5f64285d0a032e7b251d3d451a493145421e570e2f047f172f684a13020e3250153f07465a3f3c1a781e6150680d6b167b48020b090c155d0c6e277300307903644f4d570f3e324e3f791a5b6d5a1a730c3c14134b22567555251b0f456d12286c60002b2a09742d14110639152b542b0807016610530c7105235c087a301355160a1513030a15640104181e1855111b07034e3d077d51422c71414e32085043416f0a277911423b7f0c53037f150b1c757f2b0e7b2022136b420c1c2d6963506e047f7d2a7f214b2c5c1e504c2c1c2549201f72391e27584a6b301e74155238372f6b1a6152741b703155263c250e606d517d765b3b4656010e2f497a051d770a771b1020443b42207b021e2e75690302755636247c437920640b4d656c2e3f0e2f461c413675070f192c1a397b3f03673826020f24542f1e5274766c070a760c675b0a63695842370e2f007f052b7446223f003a13262810530026386a0d3c52145c23054500063b1a395e661555275438051b1d33334e535b326b6a7e09632c712451254d1700341b7c3524577c2a0c5f170721230e68621908257f7953005e147f354c1b2e3c7b5d7133524e511807146407317b484024342f450d573e402661205b4c020b16402039547c3c0e5b004775045b7d7c35330d6827715006165d1d4d13361b3f583c23645b57075f077e2a174f70522e242b610603586a3a6e167729181d7f1770194d5c17751b025b730e476a411f333e610c101c463a74011324012c7b64351f5a4c361d42176e260653014d1f777146274e2d62151f0e77437838336d070e6c68332d4a3b773469757a430c2378073a7c2f561f7c0e512e7956137d762c65792530751747322056626f083e7e002f5923533b5e38492e785d01606008576b357d42135639057d7852610305587b1f005d655d0d7b13171b144d12135c465731700d6020076c424239167f7e3e4729091b48227030783d7376131b744e200a79347e071e7e560e126a2b4065525f43220b5d4705320a3e116e59457b1533585740267f08510b33643e5b3b500457710b2e72340a2739450e1454403b117a047124247665513f7e2c4b7b6b3d7c12442f02042608096b1e15586e33715b406621160d71093c1d0a590e4b1f412e4e15760018163b750b020f42041c46116c2724606755283e786c2e7e2350296c385c2676500b493614507614355e0d7617030b6e512f07277f3a730d4b3e4a317d547e3c277a3d2e6a58127511414c3e044b1c152a227e6632691e7a295f3177473a1027602a4a6741237162044a29146a744c3f172b6e2602127a6d10165c190b34080b252e003837396b365b1f306f4444130e390100791c69391957412b0900026825086d3959197b4779162179597b3f3e3f482361306d241f50540e0505264a13106d38520b66515d243369144c3b2f346d087b0d041964080048260b784926225057141e4b23462f1e0b587e25192d6f19411d5c0c1e2e45100f5f065c09297338327970224e07167c63771c070a760b555177704a101e0479153f1f761e46720534175f0c3623495a567f392b177d5254567e5f0b400722016c1f052b774a2833433f4127186778742c08294c03660e5a644d1b003c1b2a0f50045b476607036d2f402b366f1855681f2c7e78725659076b09751c3917335a3e2f43581931733a577c1a58754839152a4c15640a4d24193c552905063478130565365f014f0741232e485c50250f1a6b7e6d0e4a1d462f41242b1d235e1a24173e332d7c0c7b19004e1c1f6935336c3e1f4a4f381f36493e382c344b1a2e047a1f2d661b1f14197f186c2c33247c1f77135a0d4a3e5d55342c70043d055a4b3b020d147b73606b50651e2212581a471b761458517b2e3a3f240d7c1868490f086e145d1e610570756f001b490c5a245a245e185836163b390b7b0d4d450a2c4c22451e600e62687924295b1c17135e35553d732c2b52047023590b6604724f1777230f4877450b3f22767e5b2140034c3f62163b0a110a051c534f500c5a387c00606e107e0a370a7e096028791d6b2e723f0c1a7971680a4a22107d430b1e74234e5f522269610c38551d403";

const testCode = `
// Mock window and document objects
const window = {};
const document = {
    getElementById: function(id) {
        console.log("Requested ID:", id);
        return { innerHTML: "${test_string_val}" };
    }
};
const URL = {
    createObjectURL: function(blob) {
        return "blob:" + blob;
    }
};
const Blob = function(content, options) {
    return content;
};

// Proxy to catch assignments to window
const proxyWindow = new Proxy(window, {
    set: function(target, prop, value) {
        console.log("Assigned to window." + prop + ":", value);
        return true;
    }
});

// Override the global window with our proxy
// Note: We can't easily override the global 'window' inside eval if it's not used explicitly.
// But the code uses 'window[...]', so we can try to define 'window' in the scope.

`;


// We'll insert our test code before the last line, and modify the last line to use our mocked environment
// The last line is: window[bMGyx71TzQLfdonN("IGLImMhWrI")] = IGLImMhWrI(document.getElementById(bMGyx71TzQLfdonN("IGLImMhWrI")).innerHTML);

// We will modify the JS content to run in our harness
const modifiedJsContent = jsContent.replace(
    /window\[bMGyx71TzQLfdonN\("IGLImMhWrI"\)\] = .*/,
    `
    // Execute the decoding and print the result
    const decoded = IGLImMhWrI("${test_string_val}");
    console.log("Decoded URL:", decoded);
    `
);

const finalCode = testCode + modifiedJsContent;

fs.writeFileSync('test/prorcp_test.js', finalCode);